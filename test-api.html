<!DOCTYPE html>
<html>
<head>
  <title>API Test</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow: auto; }
    .input-group { margin-bottom: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Projects API Test</h1>
  
  <div>
    <h2>Get All Projects</h2>
    <button onclick="getProjects()">Fetch Projects</button>
  </div>

  <div>
    <h2>Create Project</h2>
    <div class="input-group">
      <label>Title:</label>
      <input id="newTitle" type="text" value="New Test Project">
    </div>
    <div class="input-group">
      <label>Description:</label>
      <textarea id="newDesc">This is a test project created via API</textarea>
    </div>
    <div class="input-group">
      <label>Status:</label>
      <input id="newStatus" type="text" value="pending">
    </div>
    <button onclick="createProject()">Create Project</button>
  </div>

  <div>
    <h2>Get Project by ID</h2>
    <div class="input-group">
      <label>Project ID:</label>
      <input id="projectId" type="number" value="1">
    </div>
    <button onclick="getProject()">Get Project</button>
  </div>

  <div>
    <h2>Update Project</h2>
    <div class="input-group">
      <label>Project ID:</label>
      <input id="updateId" type="number" value="1">
    </div>
    <div class="input-group">
      <label>New Title:</label>
      <input id="updateTitle" type="text" value="Updated Project">
    </div>
    <div class="input-group">
      <label>New Description:</label>
      <textarea id="updateDesc">This project has been updated</textarea>
    </div>
    <div class="input-group">
      <label>New Status:</label>
      <input id="updateStatus" type="text" value="in-progress">
    </div>
    <button onclick="updateProject()">Update Project</button>
  </div>

  <div>
    <h2>Delete Project</h2>
    <div class="input-group">
      <label>Project ID to Delete:</label>
      <input id="deleteId" type="number" value="1">
    </div>
    <button onclick="deleteProject()">Delete Project</button>
  </div>

  <h2>Results:</h2>
  <pre id="results">Response will appear here...</pre>

  <script>
    const API_URL = 'http://localhost:3333/api';
    const resultsEl = document.getElementById('results');

    function showResult(data) {
      resultsEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }

    async function fetchAPI(endpoint, method = 'GET', body = null) {
      try {
        const options = {
          method,
          headers: { 'Content-Type': 'application/json' },
          // Add credentials to handle CORS properly
          credentials: 'include'
        };
        
        if (body) {
          options.body = JSON.stringify(body);
        }
        
        const response = await fetch(`${API_URL}${endpoint}`, options);
        const data = await response.json();
        showResult(data);
        return data;
      } catch (error) {
        showResult(`Error: ${error.message}`);
      }
    }

    async function getProjects() {
      return fetchAPI('/projects');
    }

    async function getProject() {
      const id = document.getElementById('projectId').value;
      return fetchAPI(`/projects/${id}`);
    }

    async function createProject() {
      const project = {
        title: document.getElementById('newTitle').value,
        description: document.getElementById('newDesc').value,
        status: document.getElementById('newStatus').value
      };
      return fetchAPI('/projects', 'POST', project);
    }

    async function updateProject() {
      const id = document.getElementById('updateId').value;
      const project = {
        title: document.getElementById('updateTitle').value,
        description: document.getElementById('updateDesc').value,
        status: document.getElementById('updateStatus').value
      };
      return fetchAPI(`/projects/${id}`, 'PUT', project);
    }

    async function deleteProject() {
      const id = document.getElementById('deleteId').value;
      return fetchAPI(`/projects/${id}`, 'DELETE');
    }
  </script>
</body>
</html>
